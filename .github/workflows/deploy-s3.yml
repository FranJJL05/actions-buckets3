name: Despliegue de la Web a AWS S3
on:
  push:
    branches:
      - dev 
  workflow_dispatch: 
  
jobs:
  pruebas-y-subida:
    runs-on: ubuntu-latest 
    steps:
      - name: 1. Bajar mi proyecto
        uses: actions/checkout@v4
      
      # 2. Configura Node.j
      - name: 2. Poner Node.js e instalar dependencias
        uses: actions/setup-node@v4
        with:
          node-version: '18.x'
          cache: 'npm'
      
      # --- INTEGRACIÃ“N CONTINUA (CI) ---
      
      # 3. Ejecutar las pruebas usando el script de npm
      - name: 3. Ejecutar las pruebas
        run: npm test
      
      - name: 4. Generar la documentacion de mi JS
        run: npm run docs 

      # --- DESPLIEGUE CONTINUO (CD) ---
      
      - name: 5. Subir los archivos finales a mi bucket de AWS S3
        uses: jakejarvis/s3-sync-action@v0.5.1
        with:
          args: --acl public-read --delete 
          
          # Claves de AWS que configuraste en los Secrets de GitHub
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_SESSION_TOKEN: ${{ secrets.AWS_SESSION_TOKEN }}
          AWS_REGION: ${{ secrets.AWS_REGION }}
          
          S3_BUCKET: ${{ secrets.S3_BUCKET_NAME }}
          
          SOURCE_DIR: './' 
          EXCLUDE: '.git* .gitignore node_modules/* package*.json package-lock.json test/* .github/*'
